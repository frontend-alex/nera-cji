@{
    ViewData["Title"] = "Events | Admin";
    Layout = "~/Views/Shared/Layouts/_LayoutRoot.cshtml";
}

<div class="p-6 space-y-6" id="admin-events">
    <div class="flex flex-col gap-3 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm">
        <div class="flex items-start justify-between gap-4">
            <div>
                <p class="text-sm text-gray-500">admin events page</p>
                <h1 class="text-2xl font-bold text-gray-900">manage Events</h1>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="rounded-2xl border border-gray-200 bg-white p-4 shadow-sm">
            <p class="text-sm text-gray-500">posted</p>
            <div class="flex items-end justify-between">
                <span class="text-2xl font-bold text-gray-900" id="admin-stat-published">0</span>
                <span class="text-xs rounded-full bg-emerald-100 text-emerald-700 px-2 py-1">Live</span>
            </div>
        </div>
        <div class="rounded-2xl border border-gray-200 bg-white p-4 shadow-sm">
            <p class="text-sm text-gray-500">drafts</p>
            <div class="flex items-end justify-between">
                <span class="text-2xl font-bold text-gray-900" id="admin-stat-drafts">0</span>
                <span class="text-xs rounded-full bg-amber-100 text-amber-700 px-2 py-1">Review</span>
            </div>
        </div>
        <div class="rounded-2xl border border-gray-200 bg-white p-4 shadow-sm">
            <p class="text-sm text-gray-500">capacity</p>
            <div class="flex items-end justify-between">
                <span class="text-2xl font-bold text-gray-900" id="admin-stat-capacity">0</span>
                <span class="text-xs rounded-full bg-gray-100 text-gray-700 px-2 py-1">Seats</span>
            </div>
        </div>
    </div>

    <div class="grid lg:grid-cols-2 gap-6">
        <div class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm">
            <div class="flex items-start justify-between">
                <div>
                    <h2 class="text-xl font-semibold text-gray-900">create event</h2>
                </div>
            </div>

            <form id="admin-create-form" class="mt-4 space-y-4">
                <div>
                    <label class="text-sm font-semibold text-gray-800">Title</label>
                    <input name="title" required class="mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:border-[#5236ab] focus:ring-[#5236ab]" placeholder="Test Event" />
                </div>
                <div class="grid sm:grid-cols-2 gap-3">
                    <div>
                        <label class="text-sm font-semibold text-gray-800">Date</label>
                        <input name="date" type="date" required class="mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:border-[#5236ab] focus:ring-[#5236ab]" />
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-800">Time</label>
                        <input name="time" type="time" required class="mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:border-[#5236ab] focus:ring-[#5236ab]" />
                    </div>
                </div>
                <div class="grid sm:grid-cols-2 gap-3">
                    <div>
                        <label class="text-sm font-semibold text-gray-800">Location</label>
                        <input name="location" required class="mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:border-[#5236ab] focus:ring-[#5236ab]" placeholder="Test Room" />
                    </div>
                </div>
                <div>
                    <label class="text-sm font-semibold text-gray-800">Description</label>
                    <textarea name="description" rows="3" class="mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:border-[#5236ab] focus:ring-[#5236ab]" placeholder="Quick test description"></textarea>
                </div>
                <div class="flex items-center gap-3">
                    <button type="submit" class="px-4 py-2 rounded-full bg-[#5236ab] text-white text-sm font-semibold">Add to list</button>
                </div>
            </form>
        </div>

        <div class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm">
            <div class="flex items-start justify-between">
                <div>
                    <h2 class="text-xl font-semibold text-gray-900">created events</h2>
                </div>
            </div>
            <div id="admin-event-list" class="mt-4 space-y-3"></div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (() => {
            const adminEvents = [
                { id: 1, title: "Example 1", date: "2025-12-01", time: "12:00", location: "Room A", capacity: 20, status: "posted", attendees: 6 },
                { id: 2, title: "Example 2", date: "2025-12-01", time: "12:00", location: "Room B", capacity: 40, status: "draft", attendees: 0 },
                { id: 3, title: "Example 3", date: "2025-12-01", time: "12:00", location: "Room C", capacity: 25, status: "draft", attendees: 3 }
            ];

            let nextId = 4;

            const stats = {
                published: document.getElementById("admin-stat-published"),
                drafts: document.getElementById("admin-stat-drafts"),
                capacity: document.getElementById("admin-stat-capacity")
            };
            const listEl = document.getElementById("admin-event-list");
            const form = document.getElementById("admin-create-form");
            const statusEl = document.getElementById("admin-form-status");

            const renderStats = () => {
                const publishedCount = adminEvents.filter(evt => evt.status === "Published").length;
                const draftCount = adminEvents.filter(evt => evt.status === "Draft").length;
                const capacityTotal = adminEvents.reduce((sum, evt) => sum + Number(evt.capacity || 0), 0);

                stats.published.textContent = publishedCount;
                stats.drafts.textContent = draftCount;
                stats.capacity.textContent = capacityTotal;
            };

            const renderList = () => {
                listEl.innerHTML = adminEvents.map(evt => `
                    <article class="rounded-xl border border-gray-200 p-4 flex flex-col gap-3">
                        <div class="flex items-start justify-between gap-2">
                            <div>
                                <p class="text-xs text-gray-500 uppercase tracking-wide">${evt.status}</p>
                                <h3 class="text-lg font-semibold text-gray-900">${evt.title}</h3>
                                <p class="text-sm text-gray-600">${evt.date} · ${evt.time} · ${evt.location}</p>
                            </div>
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${evt.status === "Published" ? "bg-emerald-100 text-emerald-700" : "bg-amber-100 text-amber-700"}">
                                ${evt.status === "Published" ? "Live" : "Draft"}
                            </span>
                        </div>
                        <div class="text-xs text-gray-500">Capacity ${evt.capacity} · ${evt.attendees} sign-ups</div>
                        <div class="flex flex-wrap gap-2">
                            <button data-action="toggle" data-id="${evt.id}" class="px-3 py-1.5 rounded-full text-sm font-semibold border border-gray-200 text-gray-800 hover:border-[#5236ab]">
                                ${evt.status === "Published" ? "Unpublish" : "Publish"}
                            </button>
                            <button data-action="duplicate" data-id="${evt.id}" class="px-3 py-1.5 rounded-full text-sm font-semibold border border-gray-200 text-gray-800 hover:border-[#5236ab]">Duplicate</button>
                            <button data-action="remove" data-id="${evt.id}" class="px-3 py-1.5 rounded-full text-sm font-semibold border border-red-200 text-red-700 hover:border-red-400">Remove</button>
                        </div>
                    </article>
                `).join("");
            };

            listEl?.addEventListener("click", (event) => {
                const button = event.target.closest("button[data-action]");
                if (!button) return;
                const id = Number(button.dataset.id);
                const action = button.dataset.action;
                const index = adminEvents.findIndex(evt => evt.id === id);
                if (index === -1) return;

                if (action === "toggle") {
                    adminEvents[index].status = adminEvents[index].status === "Published" ? "Draft" : "Published";
                }

                if (action === "duplicate") {
                    const clone = { ...adminEvents[index], id: nextId++, status: "Draft", title: `${adminEvents[index].title} Copy` };
                    adminEvents.splice(index + 1, 0, clone);
                }

                if (action === "remove") {
                    adminEvents.splice(index, 1);
                }

                renderList();
                renderStats();
            });

            form?.addEventListener("submit", (event) => {
                event.preventDefault();
                const formData = new FormData(form);
                const newEvent = {
                    id: nextId++,
                    title: formData.get("title") || "Example",
                    date: formData.get("date") || "2024-11-01",
                    time: formData.get("time") || "09:00",
                    location: formData.get("location") || "Room",
                    capacity: Number(formData.get("capacity") || 0),
                    status: formData.get("publish") ? "Published" : "Draft",
                    attendees: 0
                };
                adminEvents.unshift(newEvent);
                renderList();
                renderStats();
                form.reset();
                statusEl.textContent = "Added to list.";
            });

            renderList();
            renderStats();
        })();
    </script>
}
